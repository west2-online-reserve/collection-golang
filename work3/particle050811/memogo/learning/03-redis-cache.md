# Redis ç¼“å­˜å­¦ä¹ ç¬”è®°

æœ¬æ–‡æ¡£è®°å½• Redis ç¼“å­˜ç›¸å…³çš„å­¦ä¹ å†…å®¹ï¼ŒåŒ…æ‹¬å®ç°åŸç†ã€ä½¿ç”¨åœºæ™¯å’Œä¼˜åŒ–ç­–ç•¥ã€‚

---

## 2025-11-03 Redis ç¼“å­˜å®ç°

### Cache-Aside æ¨¡å¼ï¼ˆæ—è·¯ç¼“å­˜ï¼‰

**å®ç°ä½ç½®**ï¼š
- TodoRepository: `biz/dal/repository/todo_repo.go:123-241`
- UserRepository: `biz/dal/repository/user_repo.go:71-172`

**æ ¸å¿ƒæµç¨‹**ï¼š

```
è¯»æ“ä½œ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æŸ¥è¯¢ Redis   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€ å‘½ä¸­ â†’ è¿”å›ç¼“å­˜æ•°æ® âœ…
     â”‚
     â””â”€ æœªå‘½ä¸­
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 2. æŸ¥è¯¢æ•°æ®åº“   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 3. å†™å…¥ Redis   â”‚
    â”‚   (è®¾ç½® TTL)    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 4. è¿”å›æ•°æ®     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å†™æ“ä½œ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ›´æ–°æ•°æ®åº“   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 2. åˆ é™¤ç¼“å­˜     â”‚
    â”‚   (å¤±æ•ˆç­–ç•¥)    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 3. è¿”å›ç»“æœ     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ä»£ç ç¤ºä¾‹**ï¼ˆ`todo_repo.go:130-147`ï¼‰ï¼š

```go
// å°è¯•ä»ç¼“å­˜è·å–
if redisClient.RDB != nil {
    cacheKey := r.listCacheKey(userID, statusFilter, page, pageSize)
    ctx := context.Background()

    cachedData, err := redisClient.RDB.Get(ctx, cacheKey).Result()
    if err == nil {
        // ç¼“å­˜å‘½ä¸­ï¼Œè§£ææ•°æ®
        var cached CachedResult
        if json.Unmarshal([]byte(cachedData), &cached) == nil {
            return cached.Todos, cached.Total, nil  // ç›´æ¥è¿”å›
        }
    }
}
// err != nil æ—¶ä»£ç ç»§ç»­å‘ä¸‹æ‰§è¡Œï¼ŒæŸ¥è¯¢æ•°æ®åº“
```

---

### å®é™…ä½¿ç”¨åœºæ™¯æ¼”ç¤º

#### åœºæ™¯ 1ï¼šé¦–æ¬¡æŸ¥è¯¢ï¼ˆç¼“å­˜æœªå‘½ä¸­ï¼‰

```bash
# è¯·æ±‚ï¼šè·å–ç¬¬ä¸€é¡µå¾…åŠäº‹é¡¹
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:8888/v1/todos?status=all&page=1&page_size=10"
```

**æ‰§è¡Œæµç¨‹**ï¼š
1. âœ… æ£€æŸ¥ Redis æ˜¯å¦å¯ç”¨
2. âŒ å°è¯•è·å–ç¼“å­˜é”® `todos:list:user:1:status:all:page:1:size:10`ï¼Œæœªå‘½ä¸­
3. ğŸ” æŸ¥è¯¢ MySQL æ•°æ®åº“ï¼ˆè€—æ—¶ ~50msï¼‰
4. ğŸ’¾ å°†ç»“æœå†™å…¥ Redisï¼ŒTTL=5åˆ†é’Ÿ
5. âœ… è¿”å›ç»“æœ

---

#### åœºæ™¯ 2ï¼šç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼ˆç¼“å­˜å‘½ä¸­ï¼‰

```bash
# ç›¸åŒçš„è¯·æ±‚
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:8888/v1/todos?status=all&page=1&page_size=10"
```

**æ‰§è¡Œæµç¨‹**ï¼š
1. âœ… æ£€æŸ¥ Redis æ˜¯å¦å¯ç”¨
2. âœ… ä» Redis è·å–é”® `todos:list:user:1:status:all:page:1:size:10`ï¼Œå‘½ä¸­ï¼
3. âš¡ ç›´æ¥è¿”å›ç¼“å­˜æ•°æ®ï¼ˆè€—æ—¶ ~2msï¼‰
4. ğŸš« ä¸æŸ¥è¯¢æ•°æ®åº“

**æ€§èƒ½æå‡**ï¼š50ms â†’ 2msï¼ˆ**96% æå‡**ï¼‰

---

#### åœºæ™¯ 3ï¼šåˆ›å»ºæ–°å¾…åŠåï¼ˆç¼“å­˜å¤±æ•ˆï¼‰

```bash
# åˆ›å»ºæ–°å¾…åŠ
curl -X POST -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"title":"æ–°ä»»åŠ¡","content":"æµ‹è¯•å†…å®¹"}' \
  "http://localhost:8888/v1/todos"
```

**æ‰§è¡Œæµç¨‹**ï¼š
1. ğŸ” æ’å…¥æ•°æ®åº“æˆåŠŸ
2. ğŸ—‘ï¸ è°ƒç”¨ `invalidateUserCache(userID)`ï¼Œåˆ é™¤æ‰€æœ‰åŒ¹é… `todos:*:user:1:*` çš„ç¼“å­˜é”®
3. âœ… è¿”å›åˆ›å»ºç»“æœ

**ä¸‹æ¬¡æŸ¥è¯¢æ—¶**ï¼š
- ç¼“å­˜æœªå‘½ä¸­ï¼ˆå·²è¢«åˆ é™¤ï¼‰
- é‡æ–°æŸ¥è¯¢æ•°æ®åº“
- å†™å…¥æ–°çš„ç¼“å­˜

---

### ç¼“å­˜é”®å‘½åè§„èŒƒ

#### TodoRepository ç¼“å­˜é”®

| æ“ä½œç±»å‹ | ç¼“å­˜é”®æ ¼å¼ | ç¤ºä¾‹ |
|---------|-----------|------|
| åˆ—è¡¨æŸ¥è¯¢ | `todos:list:user:{id}:status:{status}:page:{p}:size:{s}` | `todos:list:user:1:status:all:page:1:size:10` |
| æœç´¢æŸ¥è¯¢ | `todos:search:user:{id}:kw:{keyword}:page:{p}:size:{s}` | `todos:search:user:1:kw:é‡è¦:page:1:size:10` |
| ç”¨æˆ·æ¨¡å¼ | `todos:*:user:{id}:*` | ç”¨äºæ‰¹é‡åˆ é™¤è¯¥ç”¨æˆ·æ‰€æœ‰ç¼“å­˜ |

#### UserRepository ç¼“å­˜é”®

| æ“ä½œç±»å‹ | ç¼“å­˜é”®æ ¼å¼ | ç¤ºä¾‹ |
|---------|-----------|------|
| æŒ‰ ID æŸ¥è¯¢ | `user:id:{id}` | `user:id:123` |
| æŒ‰ç”¨æˆ·åæŸ¥è¯¢ | `user:username:{name}` | `user:username:john` |

---

### TTL è¿‡æœŸæ—¶é—´è®¾ç½®

| æ•°æ®ç±»å‹ | TTL | åŸå›  |
|---------|-----|------|
| **TodoRepository** | 5 åˆ†é’Ÿ | å¾…åŠæ•°æ®å˜æ›´é¢‘ç¹ |
| **UserRepository** | 10 åˆ†é’Ÿ | ç”¨æˆ·ä¿¡æ¯ç›¸å¯¹ç¨³å®š |

**è°ƒæ•´å»ºè®®**ï¼š
- **è¯»å¤šå†™å°‘**ï¼šå¯ä»¥å»¶é•¿åˆ° 10-30 åˆ†é’Ÿ
- **å®æ—¶æ€§è¦æ±‚é«˜**ï¼šç¼©çŸ­åˆ° 1-3 åˆ†é’Ÿ
- **ä¿®æ”¹ä½ç½®**ï¼š`todo_repo.go:178` å’Œ `user_repo.go:102`

---

### ç›‘æ§ Redis ç¼“å­˜çŠ¶æ€

```bash
# è¿æ¥åˆ° Redis
redis-cli

# æŸ¥çœ‹æ‰€æœ‰å¾…åŠç¼“å­˜é”®
KEYS todos:*

# æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·ç¼“å­˜é”®
KEYS user:*

# æŸ¥çœ‹æŸä¸ªé”®çš„å†…å®¹
GET "todos:list:user:1:status:all:page:1:size:10"

# æŸ¥çœ‹æŸä¸ªé”®çš„è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
TTL "todos:list:user:1:status:all:page:1:size:10"

# æ‰‹åŠ¨åˆ é™¤æŸç”¨æˆ·çš„æ‰€æœ‰å¾…åŠç¼“å­˜
KEYS todos:*:user:1:*
# ç„¶åé€ä¸ª DEL

# æ‰‹åŠ¨æ¸…é™¤æŸä¸ªç”¨æˆ·ç¼“å­˜
DEL "user:id:123"
DEL "user:username:john"
```

---

## Redis vs Go Map å¯¹æ¯”

### Q: Redis ç›¸å½“äº map å—ï¼Ÿ

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š

**ä½ çš„ç›´è§‰æ˜¯å¯¹çš„**ï¼šRedis ç¡®å®å°±åƒä¸€ä¸ª"ç½‘ç»œç‰ˆçš„è¶…çº§ map"ï¼

ä½†å®ƒä»¬æœ‰ä¸€äº›å…³é”®åŒºåˆ«ï¼Œå†³å®šäº†ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ Redis è€Œä¸æ˜¯ç®€å•ç”¨ mapã€‚

---

### ğŸ“Š æ ¸å¿ƒå¯¹æ¯”

#### ä½¿ç”¨æ–¹å¼å¯¹æ¯”

```go
// Go Map
cache := make(map[string]string)
cache["key"] = "value"
data := cache["key"]

// Redisï¼ˆç”¨æ³•å‡ ä¹ä¸€æ ·ï¼ï¼‰
redis.RDB.Set(ctx, "key", "value", ttl)
data, _ := redis.RDB.Get(ctx, "key").Result()
```

#### ç‰¹æ€§å¯¹æ¯”è¡¨æ ¼

| ç‰¹æ€§ | Go Map | Redis |
|-----|--------|-------|
| **å­˜å‚¨ä½ç½®** | è¿›ç¨‹å†…å­˜ | ç‹¬ç«‹è¿›ç¨‹/æœåŠ¡å™¨ |
| **æ•°æ®æŒä¹…åŒ–** | âŒ è¿›ç¨‹é€€å‡ºå°±ä¸¢å¤± | âœ… å¯æŒä¹…åŒ–åˆ°ç£ç›˜ |
| **å¤šè¿›ç¨‹å…±äº«** | âŒ ä¸èƒ½è·¨è¿›ç¨‹å…±äº« | âœ… æ‰€æœ‰åº”ç”¨å…±äº«åŒä¸€ä»½æ•°æ® |
| **è¿‡æœŸæ—¶é—´ï¼ˆTTLï¼‰** | âŒ éœ€è¦æ‰‹åŠ¨å®ç° | âœ… å†…ç½®æ”¯æŒ |
| **å¹¶å‘å®‰å…¨** | âŒ éœ€è¦åŠ é”ï¼ˆsync.RWMutexï¼‰ | âœ… å¤©ç„¶çº¿ç¨‹å®‰å…¨ |
| **å†…å­˜é™åˆ¶** | å—è¿›ç¨‹å†…å­˜é™åˆ¶ | ç‹¬ç«‹å†…å­˜ç®¡ç† |
| **åˆ†å¸ƒå¼æ”¯æŒ** | âŒ å•æœº | âœ… æ”¯æŒé›†ç¾¤/ä¸»ä» |
| **æ€§èƒ½** | ğŸš€ æå¿«ï¼ˆçº³ç§’çº§ï¼‰ | âš¡ å¾ˆå¿«ï¼ˆå¾®ç§’çº§ï¼‰ |

---

### ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦ Redisï¼Ÿ

#### åœºæ™¯ 1ï¼šåº”ç”¨é‡å¯åæ•°æ®ä¿ç•™

```go
// âŒ Go Mapï¼šé‡å¯åæ•°æ®ä¸¢å¤±
func main() {
    cache := make(map[string]string)
    cache["user:123"] = "john"

    // ç¨‹åºé‡å¯å...
    // cache å˜æˆç©ºçš„äº†ï¼
}

// âœ… Redisï¼šæ•°æ®ä»ç„¶åœ¨
func main() {
    redis.Init()
    redis.RDB.Set(ctx, "user:123", "john", 0) // TTL=0 è¡¨ç¤ºæ°¸ä¸è¿‡æœŸ

    // ç¨‹åºé‡å¯å...
    // æ•°æ®è¿˜åœ¨ Redis é‡Œï¼
    data, _ := redis.RDB.Get(ctx, "user:123").Result()
    fmt.Println(data) // è¾“å‡ºï¼šjohn
}
```

---

#### åœºæ™¯ 2ï¼šå¤šå®ä¾‹å…±äº«ç¼“å­˜

```bash
# å‡è®¾ä½ æœ‰ 3 ä¸ª MemoGo å®ä¾‹åœ¨è¿è¡Œ
# å®ä¾‹ Aï¼šç«¯å£ 8888
# å®ä¾‹ Bï¼šç«¯å£ 8889
# å®ä¾‹ Cï¼šç«¯å£ 8890
```

```go
// âŒ Go Mapï¼šæ¯ä¸ªå®ä¾‹æœ‰è‡ªå·±çš„ mapï¼Œæ•°æ®ä¸å…±äº«
// å®ä¾‹ A
cache["user:123"] = "john" // åªåœ¨å®ä¾‹ A æœ‰æ•ˆ

// å®ä¾‹ B
data := cache["user:123"]  // æ‰¾ä¸åˆ°ï¼éœ€è¦å†æŸ¥æ•°æ®åº“

// âœ… Redisï¼šæ‰€æœ‰å®ä¾‹å…±äº«åŒä¸€ä¸ª Redis
// å®ä¾‹ A
redis.RDB.Set(ctx, "user:123", "john", 10*time.Minute)

// å®ä¾‹ B
data, _ := redis.RDB.Get(ctx, "user:123").Result() // èƒ½è·å–åˆ°ï¼
```

**æ•ˆæœ**ï¼š
- å®ä¾‹ A æŸ¥è¯¢æ•°æ®åº“å¹¶ç¼“å­˜
- å®ä¾‹ Bã€C ç›´æ¥ä» Redis è·å–
- é¿å…é‡å¤æŸ¥è¯¢æ•°æ®åº“

---

#### åœºæ™¯ 3ï¼šè‡ªåŠ¨è¿‡æœŸï¼ˆTTLï¼‰

```go
// âŒ Go Mapï¼šéœ€è¦æ‰‹åŠ¨å®ç°è¿‡æœŸæœºåˆ¶
type CacheItem struct {
    Value      string
    ExpireTime time.Time
}

cache := make(map[string]CacheItem)

// å†™å…¥æ—¶è®°å½•è¿‡æœŸæ—¶é—´
cache["user:123"] = CacheItem{
    Value:      "john",
    ExpireTime: time.Now().Add(10 * time.Minute),
}

// è¯»å–æ—¶æ£€æŸ¥æ˜¯å¦è¿‡æœŸï¼ˆå¾ˆéº»çƒ¦ï¼ï¼‰
item := cache["user:123"]
if time.Now().After(item.ExpireTime) {
    delete(cache, "user:123") // æ‰‹åŠ¨åˆ é™¤
    // æ•°æ®å·²è¿‡æœŸ
} else {
    // ä½¿ç”¨ item.Value
}

// è¿˜éœ€è¦å®šæ—¶æ¸…ç†è¿‡æœŸæ•°æ®ï¼ˆéœ€è¦åå° goroutineï¼‰


// âœ… Redisï¼šå†…ç½®æ”¯æŒï¼Œè‡ªåŠ¨æ¸…ç†
redis.RDB.Set(ctx, "user:123", "john", 10*time.Minute)

// 10åˆ†é’Ÿåè‡ªåŠ¨åˆ é™¤ï¼Œä¸éœ€è¦æ‰‹åŠ¨å¤„ç†ï¼
data, err := redis.RDB.Get(ctx, "user:123").Result()
if err == redis.Nil {
    // æ•°æ®å·²è¿‡æœŸï¼ˆRedis è‡ªåŠ¨åˆ é™¤äº†ï¼‰
}
```

---

#### åœºæ™¯ 4ï¼šå¹¶å‘å®‰å…¨

```go
// âŒ Go Mapï¼šå¹¶å‘ä¸å®‰å…¨ï¼Œéœ€è¦åŠ é”
type SafeCache struct {
    mu    sync.RWMutex
    data  map[string]string
}

func (c *SafeCache) Set(key, value string) {
    c.mu.Lock()         // å†™é”
    defer c.mu.Unlock()
    c.data[key] = value
}

func (c *SafeCache) Get(key string) (string, bool) {
    c.mu.RLock()        // è¯»é”
    defer c.mu.RUnlock()
    val, ok := c.data[key]
    return val, ok
}

// âœ… Redisï¼šå¤©ç„¶å¹¶å‘å®‰å…¨ï¼Œä¸éœ€è¦æ‰‹åŠ¨åŠ é”
redis.RDB.Set(ctx, "user:123", "john", 0)
redis.RDB.Get(ctx, "user:123")
// å¯ä»¥å®‰å…¨åœ°åœ¨å¤šä¸ª goroutine ä¸­è°ƒç”¨
```

---

### ğŸ’¡ ä»£ç é‡å¯¹æ¯”

#### ç”¨ Go Map å®ç°ç¼“å­˜ï¼ˆç®€åŒ–ç‰ˆï¼‰

```go
package cache

import (
    "sync"
    "time"
)

type MemoryCache struct {
    mu    sync.RWMutex
    data  map[string]cacheItem
}

type cacheItem struct {
    value      []byte
    expireTime time.Time
}

func NewMemoryCache() *MemoryCache {
    cache := &MemoryCache{
        data: make(map[string]cacheItem),
    }

    // å¯åŠ¨åå°æ¸…ç† goroutine
    go cache.cleanupExpired()

    return cache
}

func (c *MemoryCache) Set(key string, value []byte, ttl time.Duration) {
    c.mu.Lock()
    defer c.mu.Unlock()

    c.data[key] = cacheItem{
        value:      value,
        expireTime: time.Now().Add(ttl),
    }
}

func (c *MemoryCache) Get(key string) ([]byte, bool) {
    c.mu.RLock()
    defer c.mu.RUnlock()

    item, exists := c.data[key]
    if !exists {
        return nil, false
    }

    // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
    if time.Now().After(item.expireTime) {
        // æ³¨æ„ï¼šè¿™é‡Œä¸èƒ½ç›´æ¥åˆ é™¤ï¼Œå› ä¸ºæ˜¯è¯»é”
        return nil, false
    }

    return item.value, true
}

func (c *MemoryCache) cleanupExpired() {
    ticker := time.NewTicker(1 * time.Minute)
    defer ticker.Stop()

    for range ticker.C {
        c.mu.Lock()
        now := time.Now()
        for key, item := range c.data {
            if now.After(item.expireTime) {
                delete(c.data, key)
            }
        }
        c.mu.Unlock()
    }
}
```

**é—®é¢˜**ï¼š
- âŒ ä»£ç å¤æ‚ï¼ˆ100+ è¡Œï¼‰
- âŒ éœ€è¦åå°æ¸…ç† goroutine
- âŒ ä¸æ”¯æŒå¤šå®ä¾‹å…±äº«
- âŒ è¿›ç¨‹é‡å¯æ•°æ®ä¸¢å¤±

#### ç”¨ Redis å®ç°ç¼“å­˜ï¼ˆå®é™…ä»£ç ï¼‰

```go
// å°±æ˜¯æˆ‘ä»¬åœ¨ todo_repo.go ä¸­å†™çš„ï¼

// å†™å…¥
redis.RDB.Set(ctx, cacheKey, data, 5*time.Minute)

// è¯»å–
cachedData, err := redis.RDB.Get(ctx, cacheKey).Result()
```

**ä¼˜åŠ¿**ï¼š
- âœ… ä»£ç ç®€æ´ï¼ˆ2 è¡Œï¼‰
- âœ… è‡ªåŠ¨è¿‡æœŸ
- âœ… å¤šå®ä¾‹å…±äº«
- âœ… å¯æŒä¹…åŒ–

---

### ğŸ¤” ä»€ä¹ˆæ—¶å€™ç”¨ Mapï¼Ÿä»€ä¹ˆæ—¶å€™ç”¨ Redisï¼Ÿ

#### ç”¨ Go Mapï¼ˆå†…å­˜ç¼“å­˜ï¼‰

âœ… **é€‚åˆåœºæ™¯**ï¼š
- å•æœºåº”ç”¨
- æ•°æ®å¯ä»¥ä¸¢å¤±ï¼ˆä¸´æ—¶ç¼“å­˜ï¼‰
- æè‡´æ€§èƒ½è¦æ±‚ï¼ˆçº³ç§’çº§ï¼‰
- ä¸éœ€è¦æŒä¹…åŒ–
- ç¼“å­˜æ•°æ®é‡å°

âŒ **ä¸é€‚åˆ**ï¼š
- å¤šå®ä¾‹éƒ¨ç½²
- éœ€è¦æŒä¹…åŒ–
- éœ€è¦ TTL è‡ªåŠ¨è¿‡æœŸ
- ç¼“å­˜æ•°æ®é‡å¤§ï¼ˆå ç”¨è¿›ç¨‹å†…å­˜ï¼‰

#### ç”¨ Redis

âœ… **é€‚åˆåœºæ™¯**ï¼š
- å¤šå®ä¾‹éƒ¨ç½²ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰
- éœ€è¦æŒä¹…åŒ–
- éœ€è¦ TTL è‡ªåŠ¨è¿‡æœŸ
- åˆ†å¸ƒå¼ç³»ç»Ÿ
- ç¼“å­˜æ•°æ®é‡å¤§

âŒ **ä¸é€‚åˆ**ï¼š
- æè‡´æ€§èƒ½è¦æ±‚ï¼ˆmap æ›´å¿«ï¼‰
- å•æœºç®€å•åº”ç”¨ï¼ˆå¢åŠ éƒ¨ç½²å¤æ‚åº¦ï¼‰

---

### ğŸ¯ åœ¨ MemoGo é¡¹ç›®ä¸­çš„é€‰æ‹©

æˆ‘ä»¬é€‰æ‹© **Redis** çš„åŸå› ï¼š

1. âœ… **æ”¯æŒå¤šå®ä¾‹éƒ¨ç½²**ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰
2. âœ… **è‡ªåŠ¨è¿‡æœŸ**ï¼ˆä¸éœ€è¦æ‰‹åŠ¨æ¸…ç†ï¼‰
3. âœ… **æ•°æ®æŒä¹…åŒ–**ï¼ˆé‡å¯ä¸ä¸¢å¤±ï¼‰
4. âœ… **ç”Ÿäº§ç¯å¢ƒæ ‡å‡†æ–¹æ¡ˆ**
5. âœ… **ä»£ç ç®€æ´**ï¼ˆä¸éœ€è¦å®ç°å¤æ‚çš„ç¼“å­˜é€»è¾‘ï¼‰

å¦‚æœåªæ˜¯æœ¬åœ°å¼€å‘/å­¦ä¹ ï¼Œä¹Ÿå¯ä»¥ç”¨ **sync.Map** æˆ–è‡ªå®šä¹‰çš„ Map ç¼“å­˜ï¼š

```go
// ç®€å•çš„å†…å­˜ç¼“å­˜æ›¿ä»£æ–¹æ¡ˆï¼ˆä¸æ¨èç”Ÿäº§ç¯å¢ƒï¼‰
var memoryCache sync.Map

// å†™å…¥
memoryCache.Store("user:123", userData)

// è¯»å–
if data, ok := memoryCache.Load("user:123"); ok {
    // ä½¿ç”¨ data
}
```

---

### ğŸ“š æ€»ç»“

```
Redis = ç½‘ç»œç‰ˆçš„è¶…çº§ Map

ç‰¹æ€§ï¼š
âœ… é”®å€¼å¯¹å­˜å‚¨ï¼ˆåƒ mapï¼‰
âœ… è·¨è¿›ç¨‹/è·¨æœºå™¨å…±äº«
âœ… è‡ªåŠ¨è¿‡æœŸï¼ˆTTLï¼‰
âœ… æ•°æ®æŒä¹…åŒ–
âœ… å¹¶å‘å®‰å…¨
âœ… æ”¯æŒé›†ç¾¤
```

**ç±»æ¯”**ï¼š
- **Go Map**ï¼šä½ çš„ç§äººç¬”è®°æœ¬ï¼ˆåªæœ‰ä½ èƒ½çœ‹ï¼Œä¸¢äº†å°±æ²¡äº†ï¼‰
- **Redis**ï¼šäº‘ç«¯ç¬”è®°æœ¬ï¼ˆå¤§å®¶éƒ½èƒ½çœ‹ï¼Œä¸æ€•ä¸¢å¤±ï¼‰

ä½ çš„ç†è§£éå¸¸å‡†ç¡®ï¼Redis çš„ **Set/Get/Del** æ“ä½œå’Œ map çš„ä½¿ç”¨æ–¹å¼å‡ ä¹ä¸€æ ·ï¼Œä½†å®ƒæä¾›äº†æ›´å¤šç”Ÿäº§ç¯å¢ƒéœ€è¦çš„åŠŸèƒ½ã€‚

---

## å¸¸è§é—®é¢˜

### Q1: Redis è¿æ¥å¤±è´¥ä¼šæ€æ ·ï¼Ÿ
**A**: ç³»ç»Ÿä¼šè‡ªåŠ¨é™çº§ï¼Œè·³è¿‡æ‰€æœ‰ç¼“å­˜é€»è¾‘ï¼Œç›´æ¥æŸ¥è¯¢æ•°æ®åº“ã€‚æ—¥å¿—ä¼šæ˜¾ç¤ºï¼š
```
Warning: Failed to connect to Redis: ... (caching will be disabled)
```

### Q2: ä¸ºä»€ä¹ˆå†™æ“ä½œè¦åˆ é™¤æ‰€æœ‰ç”¨æˆ·ç¼“å­˜ï¼Ÿ
**A**: å› ä¸ºä¸€ä¸ªå¾…åŠçš„åˆ›å»º/ä¿®æ”¹/åˆ é™¤å¯èƒ½å½±å“å¤šä¸ªæŸ¥è¯¢ç»“æœï¼š
- `status=all` çš„åˆ—è¡¨
- `status=todo` çš„åˆ—è¡¨
- æœç´¢ç»“æœ
- ä¸åŒåˆ†é¡µçš„ç»“æœ

ä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œç®€å•ç²—æš´åœ°åˆ é™¤è¯¥ç”¨æˆ·æ‰€æœ‰ç¼“å­˜ã€‚

### Q3: ä¸ºä»€ä¹ˆ UserRepository çš„ TTL æ›´é•¿ï¼Ÿ
**A**:
- **TodoRepositoryï¼ˆ5åˆ†é’Ÿï¼‰**ï¼šå¾…åŠæ•°æ®ç»å¸¸åˆ›å»º/æ›´æ–°/åˆ é™¤
- **UserRepositoryï¼ˆ10åˆ†é’Ÿï¼‰**ï¼šç”¨æˆ·ä¿¡æ¯ç›¸å¯¹ç¨³å®šï¼Œä¿®æ”¹é¢‘ç‡ä½

### Q4: å¦‚ä½•ä¼˜åŒ–ç¼“å­˜ç­–ç•¥ï¼Ÿ
**A**: å¯ä»¥è€ƒè™‘ï¼š
1. **ç²¾å‡†å¤±æ•ˆ**ï¼šåªåˆ é™¤å—å½±å“çš„ç¼“å­˜é”®ï¼ˆå¤æ‚åº¦é«˜ï¼‰
2. **çƒ­ç‚¹æ•°æ®é¢„çƒ­**ï¼šå¯åŠ¨æ—¶é¢„åŠ è½½å¸¸ç”¨æŸ¥è¯¢
3. **ç¼“å­˜ç©¿é€é˜²æŠ¤**ï¼šç©ºç»“æœä¹Ÿç¼“å­˜ï¼ˆTTL 1åˆ†é’Ÿï¼‰
4. **å¸ƒéš†è¿‡æ»¤å™¨**ï¼šé˜²æ­¢ç¼“å­˜ç©¿é€æ”»å‡»
5. **ç¼“å­˜é¢„çƒ­**ï¼šé«˜å³°å‰æå‰åŠ è½½çƒ­ç‚¹æ•°æ®

---

## å»¶ä¼¸é˜…è¯»

- Redis å®˜æ–¹æ–‡æ¡£: https://redis.io/docs/
- Cache-Aside Pattern: https://learn.microsoft.com/en-us/azure/architecture/patterns/cache-aside
- Redis æœ€ä½³å®è·µ: https://redis.io/docs/manual/patterns/
- Go Redis å®¢æˆ·ç«¯æ–‡æ¡£: https://redis.uptrace.dev/
